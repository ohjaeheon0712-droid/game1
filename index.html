// --- 각 이미지의 실제 모양에 맞게 물리 모델(Vertices) 수정 ---
const blockConfigs = {
    "Square": {
        // 정사각형 모양 (80x80 이미지 기준)
        vertices: [{x:-40, y:-40}, {x:40, y:-40}, {x:40, y:40}, {x:-40, y:40}],
        image: "images/9aff562fdf575bcacbea3cd3330c576e (3).png",
        color: "#4CAF50", w: 80, h: 80
    },
    "Diamond": {
        // 마름모 모양 (중앙에서 끝점까지의 거리를 정교하게 조절)
        vertices: [{x:0, y:-45}, {x:45, y:0}, {x:0, y:45}, {x:-45, y:0}],
        image: "images/9aff562fdf575bcacbea3cd3330c576e.png",
        color: "#2196F3", w: 90, h: 90
    },
    "L_Shape": {
        // ⭐ L자 모양의 투명한 공간을 물리적으로 비우기 위해 두 개의 사각형(Parts)을 합침
        // 아래 숫자를 조절하여 이미지 속 L자 두께와 길이에 딱 맞추세요.
        parts: [
            { x: 0, y: 20, w: 80, h: 40 },   // L의 가로 바닥 부분
            { x: -20, y: -20, w: 40, h: 40 } // L의 세로 기둥 부분
        ],
        image: "images/63a1aff59ec47d0b600ea81c51125b1d (1).png",
        color: "#FF9800", w: 100, h: 100
    }
};

// ... (기타 코드는 동일) ...

// 블록 생성 시 실제 모양 적용 부분
window.addEventListener('mousedown', () => {
    if (canCreate && !gameOver) {
        const config = blockConfigs[ghost.type];
        const img = getImg(config.image);
        const isImageLoaded = img.complete && img.naturalWidth !== 0;

        let newBody;
        if (isImageLoaded) {
            if (ghost.type === "L_Shape") {
                // L자 모양은 두 개의 파츠를 합쳐서 'ㄴ' 모양 히트박스를 만듭니다.
                const p1 = Bodies.rectangle(ghost.x + config.parts[0].x, ghost.y + config.parts[0].y, config.parts[0].w, config.parts[0].h);
                const p2 = Bodies.rectangle(ghost.x + config.parts[1].x, ghost.y + config.parts[1].y, config.parts[1].w, config.parts[1].h);
                newBody = Body.create({ parts: [p1, p2] });
            } else {
                // 사각형과 마름모는 설정된 꼭짓점(vertices) 대로 깎아서 만듭니다.
                newBody = Bodies.fromVertices(ghost.x, ghost.y, [config.vertices]);
            }
        } else {
            // 이미지가 없으면 그냥 사각형 박스로 대응
            newBody = Bodies.rectangle(ghost.x, ghost.y, 100, 100);
        }
        
        // ... (나머지 설정 및 추가 로직)
    }
});
