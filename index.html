<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>High-Stack Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; background: #222; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: white; overflow: hidden; }
        canvas { background: #fff; border: 5px solid #555; cursor: crosshair; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <h1 id="score">Blocks: 0</h1>
        <p>화면을 클릭하면 상자가 떨어집니다!</p>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        // 1. 엔진 초기화 확인
        if (typeof Matter === 'undefined') {
            alert("물리 엔진을 불러오지 못했습니다. 인터넷 연결을 확인해주세요.");
        }

        const { Engine, World, Bodies, Composite, Body } = Matter;
        const engine = Engine.create();
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 600;
        canvas.height = 700;

        // 2. 바닥 생성 (짧고 굵게)
        const ground = Bodies.rectangle(300, 680, 200, 40, { isStatic: true });
        Composite.add(engine.world, ground);

        let blocks = [];
        let score = 0;

        // 3. 클릭 시 상자 생성
        window.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            
            // 이미지 없이 단순한 빨간 상자 생성
            const box = Bodies.rectangle(mouseX, 100, 50, 50, { restitution: 0.5 });
            blocks.push(box);
            Composite.add(engine.world, box);
            
            score++;
            document.getElementById('score').innerText = "Blocks: " + score;
        });

        // 4. 애니메이션 루프 (그리기)
        function update() {
            Engine.update(engine);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 바닥 그리기
            ctx.fillStyle = "#333";
            ctx.fillRect(300 - 100, 660, 200, 40);

            // 상자들 그리기
            ctx.fillStyle = "red";
            blocks.forEach(body => {
                const { x, y } = body.position;
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(body.angle);
                ctx.fillRect(-25, -25, 50, 50); // 50x50 크기 빨간 상자
                ctx.restore();
            });

            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
